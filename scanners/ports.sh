# Copyright 2020 FireEye, Inc. and Citrix Systems, Inc.

scan_port_notrobin() {
    # ref: https://www.fireeye.com/blog/threat-research/2020/01/vigilante-deploying-mitigation-for-citrix-netscaler-vulnerability-while-maintaining-backdoor.html
    # look for entry like: nobody httpd 1351 3 udp4 6 *:18634 *:*
    local readonly entries=$(sockstat -4 -l | grep "udp" | grep ":18634")
    if [ -n "$entries" ]; then
        report_match "UDP port 18634, known artifact of NOTROBIN.";
        report "identified ports:";
        report "$entries";
    else
        debug "did not find UDP port 18634";
    fi
}

scan_ports() {
    # it only makes sense to scan ports when inspecting a running system.
    if $live_mode; then
        scan_port_notrobin;
    fi
}